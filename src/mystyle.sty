\ProvidesPackage{mystyle}

\usepackage[utf8]{inputenc}
\usepackage[italian]{babel}

% Logic
\usepackage{ifthen}

% Style
\usepackage[italian=quotes]{csquotes}
\usepackage[a4paper]{geometry}
\usepackage{emptypage}
\usepackage{frontespizio}

% Header
\usepackage{fancyhdr}
\fancypagestyle{plain}{%
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[RO,LE]{\textbf{\thepage}}
}
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\footrulewidth}{0.4pt}
\fancyhead[RO,LE]{\nouppercase{\leftmark}}
\fancyfoot[RO,LE]{\textbf{\thepage}}
\renewcommand{\chaptermark}[1]{%
\markboth{\chaptername
\ \thechapter.\ #1}{}}

% Math packages
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{bbm}
\usepackage{thmtools}
\usepackage{thm-restate}

% Bibliography
\usepackage[style=alphabetic,backend=biber,sorting=none]{biblatex}
\addbibresource{bibliography.bib}
\newcommand*{\citechapter}[2]{\cite[cap.\ #2]{#1}}
\newcommand*{\citenumber}[3]{\cite[cap.\ #2, n\(^\circ\) #3]{#1}}
\newcommand*{\citepage}[2]{\cite[p.\ #2]{#1}}
\newcommand*{\citetheorem}[2]{\cite[th.\ #2]{#1}}

% Lists
\usepackage[shortlabels]{enumitem}
\setlist[enumerate,1]{label={(\roman*)}}
\setlist[itemize,1]{label=\tiny\(\blacksquare\)}

% Tables
\usepackage{ltablex}
\keepXColumns
\newcolumntype{Y}{>{\centering\arraybackslash}X}

% Diagrams
\usepackage{tikz}
\usepackage{tikz-cd}
\tikzset{
  symbol/.style={
    draw=none,
    every to/.append style={
      edge node={node [sloped, allow upside down, auto=false]{$#1$}}}
  }
}
\newenvironment*{diagram}[1][]{\begin{equation*}\begin{tikzcd}[#1]}{\end{tikzcd}\end{equation*}}
\newcommand*{\longexactsequence}[2]{%
\begin{flalign*}\begin{tikzcd}[ampersand replacement=\&]#1\end{tikzcd}&&\end{flalign*}%
\vspace{-0.4cm}%
\begin{flalign*}&&\begin{tikzcd}[ampersand replacement=\&]#2\end{tikzcd}\end{flalign*}%
}

% Spectral sequences
\usepackage{spectralsequences}
\newcommand*{\drawsseq}[2]{%
\begin{sseqpage}[grid=chess,minor tick step=1,run off=...-...,#1 Serre grading,x range={0}{5},y range={0}{5},xscale=0.6,yscale=0.6,title={$r=#2$},differentials={-stealth,shorten <=0.05cm,shorten >=0.05cm}]
\def\r{#2}
\begin{scope}[background]
\node at (\xmax+1.2,-1) {p};
\node at (-1,\ymax+1.2) {q};
\end{scope}
\foreach \p in {0,...,\the\numexpr5+\r\relax}
\foreach \q in {0,...,\the\numexpr6+\r\relax}{
\class(\p,\q)
}
\foreach \p in {\r,...,\the\numexpr5+\r\relax}
\foreach \q in {0,...,6}{
\def\pp{\the\numexpr\p-\r\relax}
\def\qq{\the\numexpr\q+\r-1\relax}
\ifthenelse{\qq<0\OR\(\p>5\AND\(\pp<0\OR\qq<0\OR\qq>5\)\)}{}{\d\r(\p,\q);\classoptions[fill,minimum size=0.1cm](\p,\q);\classoptions[fill,minimum size=0.1cm](\pp,\qq)}
}
\end{sseqpage}
}

% References
\usepackage{hyperref}
\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}
\usepackage[lowercase]{theoremref}

% Debug
\usepackage[italian]{todonotes}
\ifdefined\debug%
    \newcommand*{\missing}{\(\blacksquare\)}%
    % Unused labels
    \usepackage{refcheck}%
    \renewcommand*{\thlabel}[1]{\label{#1}}%
    \renewcommand*{\thref}[1]{\ref{#1}}%
\else%
    \renewcommand*{\listoftodos}{}
    \renewcommand*{\todo}[1]{}
\fi

% Prescript
\usepackage{tensor}
\let\oldtensor\tensor
\newcommand*{\pre}[2]{\oldtensor*[^{#1}]{#2}{}}

% Equation item
\newcommand\eqitem[1][]{%
  \ifx\relax#1\relax  \item \else \item[#1] \fi
  \abovedisplayskip=0pt\abovedisplayshortskip=0pt~\vspace*{-\baselineskip}}

% Theorem environments
\theoremstyle{definition}
\newtheorem{definition}{Definizione}[chapter]
\newtheorem*{definition*}{Definizione}
\newtheorem*{notation*}{Notazione}
\theoremstyle{plain}
\newtheorem{theorem}{Teorema}[chapter]
\newtheorem{proposition}[theorem]{Proposizione}
\newtheorem*{proposition*}{Proposizione}
\newtheorem{corollary}[theorem]{Corollario}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem*{lemma*}{Lemma}
\newcommand*{\defterm}[1]{\emph{#1}}

% Operators
\newcommand*{\dirsum}{\mathbin{\oplus}}
\newcommand*{\Dirsum}{\bigoplus}
\renewcommand*{\tensor}{\mathbin{\otimes}}
\newcommand*{\cupp}{\mathbin{\smile}}
\newcommand*{\norm}[1]{\left\lVert #1\right\rVert}

% Mathbb
\newcommand*{\1}{\mathbbm{1}}
\newcommand*{\NN}{\mathbb{N}}
\newcommand*{\ZZ}{\mathbb{Z}}
\newcommand*{\RR}{\mathbb{R}}

% Relations
\newcommand*{\subs}{\subseteq}
\newcommand*{\sups}{\supseteq}
\newcommand*{\iso}{\simeq}

% Other aliases
\newcommand*{\del}{\partial}
\newcommand*{\converges}{\Rightarrow}
\newcommand*{\phantomop}{\phantom{{}={}}}

% Maps
\newcommand*{\map}[3]{#1\colon#2\mathchoice{\longrightarrow}{\to}{\to}{\to}#3}
\newcommand*{\Map}[5]{%
\begin{alignat*}{2}
#1:\;&&#2&\longrightarrow#3\\
&&#4&\longmapsto#5
\end{alignat*}
}\newcommand*{\uMap}[4]{%
\begin{align*}
#1&\longrightarrow#2\\
#3&\longmapsto#4
\end{align*}
}
\newcommand*{\fibration}[3]{#1\hookrightarrow #2\to #3}

% Mysterious terms
\newcommand*{\cupproduct}{prodotto cup}

% DeclareMathOperator
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Ann}{Ann}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Tor}{Tor}